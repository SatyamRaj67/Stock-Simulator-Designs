<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Filter Table</title>
    <style>
        /* --- 1. CSS VARIABLES & RESET --- */
        :root {
            --primary: #2563eb;
            --surface: #ffffff;
            --bg: #f3f4f6;
            --border: #e5e7eb;
            --text: #1f2937;
            --text-sub: #6b7280;
        }
        * { box-sizing: border-box; }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); padding: 1.5rem; color: var(--text); }

        /* --- 2. FILTER BAR (The New Stuff) --- */
        .filter-container {
            background: var(--surface);
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        .filter-group label {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-sub);
            text-transform: uppercase;
        }

        .input-control {
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.9rem;
            color: var(--text);
            background: #fff;
        }
        
        .input-control:focus { outline: 2px solid var(--primary); border-color: transparent; }

        /* Layout tweaks for specific inputs */
        .search-box { flex-grow: 1; min-width: 200px; }
        .date-input { width: 130px; }
        .price-input { width: 100px; }
        .select-input { width: 120px; }

        /* --- 3. TABLE STYLES (Same as before) --- */
        .table-wrap {
            background: var(--surface);
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            overflow: hidden;
            border: 1px solid var(--border);
        }
        table { width: 100%; border-collapse: collapse; text-align: left; }
        
        th {
            background: #f9fafb;
            padding: 1rem;
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--text-sub);
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            user-select: none;
        }
        th:hover { background: #e5e7eb; }
        th.sort-asc::after { content: " ↑"; color: var(--primary); }
        th.sort-desc::after { content: " ↓"; color: var(--primary); }

        td { padding: 1rem; border-bottom: 1px solid var(--border); font-size: 0.95rem; }

        /* Badges */
        .badge { padding: 0.25rem 0.6rem; border-radius: 99px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; }
        .bg-completed { background: #dcfce7; color: #166534; }
        .bg-pending { background: #fef9c3; color: #854d0e; }
        .bg-cancelled { background: #fee2e2; color: #991b1b; }

        /* --- 4. PAGINATION FOOTER --- */
        .footer {
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f9fafb;
            border-top: 1px solid var(--border);
        }
        .pagination-btns { display: flex; gap: 0.5rem; }
        .page-btn {
            border: 1px solid var(--border);
            background: white;
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            cursor: pointer;
        }
        .page-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .page-btn:disabled { opacity: 0.5; cursor: default; }

        /* --- 5. MOBILE RESPONSIVE --- */
        @media (max-width: 850px) {
            .filter-container { display: grid; grid-template-columns: 1fr 1fr; }
            .search-box { grid-column: 1 / -1; } /* Search takes full width */
            
            thead { display: none; }
            table, tbody, tr, td { display: block; width: 100%; }
            tr {
                margin: 1rem;
                border: 1px solid var(--border);
                border-radius: 8px;
                padding: 1rem;
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 0.5rem;
            }
            td { padding: 0; border: none; display: flex; flex-direction: column; }
            td::before { content: attr(data-label); font-size: 0.7rem; color: var(--text-sub); text-transform: uppercase; margin-bottom: 0.2rem;}
            
            /* Card Layout Logic */
            td[data-label="Stock"] { grid-column: 1; font-weight: bold; font-size: 1.1rem; }
            td[data-label="Type"] { grid-column: 1; }
            td[data-label="Total Value"] { grid-column: 2; text-align: right; font-weight: bold; font-size: 1.1rem; align-items: flex-end; }
            td[data-label="Status"] { grid-column: 2; text-align: right; align-items: flex-end; }
            
            /* Full width divider for details */
            td[data-label="Price"], td[data-label="Date"], td[data-label="Shares"] {
                grid-column: 1 / -1;
                flex-direction: row;
                justify-content: space-between;
                border-top: 1px dashed var(--border);
                padding-top: 0.5rem;
                margin-top: 0.5rem;
            }
        }
    </style>
</head>
<body>

    <div class="filter-container">
        <div class="filter-group search-box">
            <label>Search</label>
            <input type="text" class="input-control" id="searchInput" placeholder="Search stock or ID...">
        </div>
        
        <div class="filter-group">
            <label>Status</label>
            <select class="input-control select-input" id="statusFilter">
                <option value="All">All</option>
                <option value="COMPLETED">Completed</option>
                <option value="PENDING">Pending</option>
                <option value="CANCELLED">Cancelled</option>
            </select>
        </div>

        <div class="filter-group">
            <label>From Date</label>
            <input type="date" class="input-control date-input" id="startDate">
        </div>
        <div class="filter-group">
            <label>To Date</label>
            <input type="date" class="input-control date-input" id="endDate">
        </div>

        <div class="filter-group">
            <label>Min Price</label>
            <input type="number" class="input-control price-input" id="minPrice" placeholder="0">
        </div>
        <div class="filter-group">
            <label>Max Price</label>
            <input type="number" class="input-control price-input" id="maxPrice" placeholder="Max">
        </div>
    </div>

    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th onclick="handleSort('type')">Type</th>
                    <th onclick="handleSort('stock')">Stock</th>
                    <th onclick="handleSort('shares')">Shares</th>
                    <th onclick="handleSort('price')">Price</th>
                    <th onclick="handleSort('total')">Total Value</th>
                    <th onclick="handleSort('date')">Date</th>
                    <th onclick="handleSort('status')">Status</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>

        <div class="footer">
            <div class="filter-group">
                <select class="input-control" id="rowsPerPage" onchange="handleRowsChange(this)">
                    <option value="5">5 rows</option>
                    <option value="10">10 rows</option>
                    <option value="20">20 rows</option>
                </select>
            </div>
            <div class="pagination-btns" id="pagination"></div>
        </div>
    </div>

    <script>
        // --- 1. DATA ---
        const rawData = [
            { id: 1, type: "Buy", stock: "AAPL", shares: 10, price: 150.00, date: "2024-01-05", status: "COMPLETED" },
            { id: 2, type: "Buy", stock: "MSFT", shares: 5, price: 372.50, date: "2024-01-08", status: "COMPLETED" },
            { id: 3, type: "Sell", stock: "AAPL", shares: 4, price: 158.00, date: "2024-01-10", status: "CANCELLED" },
            { id: 4, type: "Buy", stock: "TSLA", shares: 3, price: 242.00, date: "2024-01-12", status: "PENDING" },
            { id: 5, type: "Buy", stock: "NVDA", shares: 2, price: 560.00, date: "2024-01-16", status: "COMPLETED" },
            { id: 6, type: "Sell", stock: "TSLA", shares: 1, price: 255.00, date: "2024-01-18", status: "COMPLETED" },
            { id: 7, type: "Buy", stock: "AMZN", shares: 6, price: 162.00, date: "2024-01-22", status: "COMPLETED" },
            { id: 8, type: "Sell", stock: "MSFT", shares: 2, price: 381.00, date: "2024-01-26", status: "PENDING" },
            { id: 9, type: "Buy", stock: "GOOGL", shares: 15, price: 140.00, date: "2024-02-01", status: "COMPLETED" },
            { id: 10, type: "Sell", stock: "NVDA", shares: 1, price: 580.00, date: "2024-02-05", status: "COMPLETED" },
            { id: 11, type: "Buy", stock: "BTC", shares: 0.5, price: 42000, date: "2024-02-10", status: "COMPLETED" },
        ];

        // --- 2. STATE ---
        let state = {
            data: rawData,
            page: 1,
            rows: 5,
            sortKey: null,
            sortOrder: 'asc',
            filters: {
                search: '',
                status: 'All',
                start: '',
                end: '',
                minPrice: '',
                maxPrice: ''
            }
        };

        // --- 3. THE PIPELINE (Filter -> Sort -> Paginate) ---
        function updateTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            // A. FILTERING
            let filtered = state.data.filter(item => {
                // 1. Search
                const matchSearch = item.stock.toLowerCase().includes(state.filters.search.toLowerCase()) || 
                                    item.type.toLowerCase().includes(state.filters.search.toLowerCase());
                // 2. Status
                const matchStatus = state.filters.status === 'All' || item.status === state.filters.status;
                // 3. Date Range
                const date = new Date(item.date);
                const afterStart = !state.filters.start || date >= new Date(state.filters.start);
                const beforeEnd = !state.filters.end || date <= new Date(state.filters.end);
                // 4. Price Range
                const aboveMin = !state.filters.minPrice || item.price >= parseFloat(state.filters.minPrice);
                const belowMax = !state.filters.maxPrice || item.price <= parseFloat(state.filters.maxPrice);

                return matchSearch && matchStatus && afterStart && beforeEnd && aboveMin && belowMax;
            });

            // B. SORTING
            if (state.sortKey) {
                filtered.sort((a, b) => {
                    let valA = a[state.sortKey];
                    let valB = b[state.sortKey];
                    // Handle computed 'total'
                    if(state.sortKey === 'total') { valA = a.price * a.shares; valB = b.price * b.shares; }
                    
                    if (valA < valB) return state.sortOrder === 'asc' ? -1 : 1;
                    if (valA > valB) return state.sortOrder === 'asc' ? 1 : -1;
                    return 0;
                });
            }

            // C. PAGINATION
            const totalPages = Math.ceil(filtered.length / state.rows);
            // Ensure we don't stay on page 5 if filtering reduces results to 1 page
            if (state.page > totalPages) state.page = 1; 
            
            const start = (state.page - 1) * state.rows;
            const paginated = filtered.slice(start, start + parseInt(state.rows));

            // D. RENDER ROWS
            paginated.forEach(row => {
                const total = (row.shares * row.price).toLocaleString('en-US', {style:'currency', currency:'USD'});
                const price = row.price.toLocaleString('en-US', {style:'currency', currency:'USD'});
                const statusClass = `bg-${row.status.toLowerCase()}`;
                
                const tr = `
                    <tr>
                        <td data-label="Type"><span class="text-${row.type.toLowerCase()}" style="font-weight:bold">${row.type}</span></td>
                        <td data-label="Stock"><strong>${row.stock}</strong></td>
                        <td data-label="Shares">${row.shares}</td>
                        <td data-label="Price">${price}</td>
                        <td data-label="Total Value"><strong>${total}</strong></td>
                        <td data-label="Date">${row.date}</td>
                        <td data-label="Status"><span class="badge ${statusClass}">${row.status}</span></td>
                    </tr>
                `;
                tbody.innerHTML += tr;
            });

            renderPagination(totalPages);
        }

        // --- 4. CONTROLS RENDERING ---
        function renderPagination(totalPages) {
            const container = document.getElementById('pagination');
            container.innerHTML = '';
            
            for(let i=1; i<=totalPages; i++) {
                const btn = document.createElement('button');
                btn.className = `page-btn ${i === state.page ? 'active' : ''}`;
                btn.textContent = i;
                btn.onclick = () => { state.page = i; updateTable(); };
                container.appendChild(btn);
            }
        }

        // --- 5. EVENT LISTENERS (Centralized) ---
        
        // Listen to ALL inputs in the filter container
        document.querySelectorAll('.input-control').forEach(input => {
            input.addEventListener('input', (e) => {
                const id = e.target.id;
                // Map input IDs to state properties
                if(id === 'searchInput') state.filters.search = e.target.value;
                if(id === 'statusFilter') state.filters.status = e.target.value;
                if(id === 'startDate') state.filters.start = e.target.value;
                if(id === 'endDate') state.filters.end = e.target.value;
                if(id === 'minPrice') state.filters.minPrice = e.target.value;
                if(id === 'maxPrice') state.filters.maxPrice = e.target.value;
                
                updateTable(); // Re-run pipeline
            });
        });

        function handleSort(key) {
            if(state.sortKey === key) {
                state.sortOrder = state.sortOrder === 'asc' ? 'desc' : 'asc';
            } else {
                state.sortKey = key;
                state.sortOrder = 'asc';
            }
            updateTable();
        }

        function handleRowsChange(select) {
            state.rows = parseInt(select.value);
            state.page = 1; // Reset to page 1
            updateTable();
        }

        // Init
        updateTable();

    </script>
</body>
</html>